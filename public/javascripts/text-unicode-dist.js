!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.otLib=t():e.otLib=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uniToStrPos=t.strPosToUni=void 0,t.strPosToUni=(e,t=e.length)=>{let n=0,r=0;for(;r<t;r++){const t=e.charCodeAt(r);t>=55296&&t<=57343&&(n++,r++)}if(r!==t)throw Error("Invalid offset - splits unicode bytes");return r-n},t.uniToStrPos=(e,t)=>{let n=0;for(;t>0;t--){const t=e.charCodeAt(n);n+=t>=55296&&t<=57343?2:1}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uniSlice=t.dlen=t.eachOp=void 0;const r=n(0),o=e=>{if(!Array.isArray(e))throw Error("Op must be an array of components");let n=null;for(let r=0;r<e.length;r++){const o=e[r];switch(typeof o){case"object":if("number"!=typeof o.d&&"string"!=typeof o.d)throw Error("Delete must be number or string");if(t.dlen(o.d)<=0)throw Error("Deletes must not be empty");break;case"string":if(!(o.length>0))throw Error("Inserts cannot be empty");break;case"number":if(!(o>0))throw Error("Skip components must be >0");if("number"==typeof n)throw Error("Adjacent skip components should be combined")}n=o}if("number"==typeof n)throw Error("Op has a trailing skip")};function i(e,n){let o=0,i=0;for(let s=0;s<e.length;s++){const a=e[s];switch(n(a,o,i),typeof a){case"object":o+=t.dlen(a.d);break;case"string":i+=r.strPosToUni(a);break;case"number":o+=a,i+=a}}}function s(e,t){const n=[],r=u(n);return i(e,(e,n,o)=>{r(t(e,n,o))}),p(n)}t.eachOp=i;const a=e=>e,c=e=>s(e,a);t.dlen=e=>"number"==typeof e?e:r.strPosToUni(e);const u=e=>n=>{if(n&&0!==n.d&&""!==n.d)if(0===e.length)e.push(n);else if(typeof n==typeof e[e.length-1])if("object"==typeof n){const r=e[e.length-1];r.d="string"==typeof r.d&&"string"==typeof n.d?r.d+n.d:t.dlen(r.d)+t.dlen(n.d)}else e[e.length-1]+=n;else e.push(n);else;},l=e=>"number"==typeof e?e:"string"==typeof e?r.strPosToUni(e):"number"==typeof e.d?e.d:r.strPosToUni(e.d);t.uniSlice=(e,t,n)=>{const o=r.uniToStrPos(e,t),i=null==n?1/0:r.uniToStrPos(e,n);return e.slice(o,i)};const f=(e,n,r)=>"number"==typeof e?null==r?e-n:Math.min(e,r)-n:t.uniSlice(e,n,r),d=e=>{let n=0,o=0;return{take:(i,s)=>{if(n===e.length)return-1===i?null:i;const a=e[n];let c;if("number"==typeof a)return-1===i||a-o<=i?(c=a-o,++n,o=0,c):(o+=i,i);if("string"==typeof a){if(-1===i||"i"===s||r.strPosToUni(a.slice(o))<=i)return c=a.slice(o),++n,o=0,c;{const e=o+r.uniToStrPos(a.slice(o),i);return c=a.slice(o,e),o=e,c}}if(-1===i||"d"===s||t.dlen(a.d)-o<=i)return c={d:f(a.d,o)},++n,o=0,c;{let e=f(a.d,o,o+i);return o+=i,{d:e}}},peek:()=>e[n]}},p=e=>(e.length>0&&"number"==typeof e[e.length-1]&&e.pop(),e);function h(e,n,i){if("left"!==i&&"right"!==i)throw Error("side ("+i+") must be 'left' or 'right'");o(e),o(n);const s=[],a=u(s),{take:c,peek:f}=d(e);for(let e=0;e<n.length;e++){const o=n[e];let s,u;switch(typeof o){case"number":for(s=o;s>0;)u=c(s,"i"),a(u),"string"!=typeof u&&(s-=l(u));break;case"string":"left"===i&&"string"==typeof f()&&a(c(-1)),a(r.strPosToUni(o));break;case"object":for(s=t.dlen(o.d);s>0;)switch(u=c(s,"i"),typeof u){case"number":s-=u;break;case"string":a(u);break;case"object":s-=t.dlen(u.d)}}}let h;for(;h=c(-1);)a(h);return p(s)}function b(e,n){o(e),o(n);const i=[],s=u(i),{take:a}=d(e);for(let e=0;e<n.length;e++){const o=n[e];let i,c;switch(typeof o){case"number":for(i=o;i>0;)c=a(i,"d"),s(c),"object"!=typeof c&&(i-=l(c));break;case"string":s(o);break;case"object":i=t.dlen(o.d);let e=0;for(;e<i;)switch(c=a(i-e,"d"),typeof c){case"number":s({d:f(o.d,e,e+c)}),e+=c;break;case"string":e+=r.strPosToUni(c);break;case"object":s(c)}}}let c;for(;c=a(-1);)s(c);return p(i)}const g=(e,n)=>{let o=0;for(let i=0;i<n.length&&e>o;i++){const s=n[i];switch(typeof s){case"number":o+=s;break;case"string":const n=r.strPosToUni(s);o+=n,e+=n;break;case"object":e-=Math.min(t.dlen(s.d),e-o)}}return e},y=(e,t)=>"number"==typeof e?g(e,t):e.map(e=>g(e,t));function m(e,t,n){return s(e,(e,r)=>"object"==typeof e&&"number"==typeof e.d?{d:n.slice(t,r,r+e.d)}:e)}function v(e){return s(e,e=>{switch(typeof e){case"object":if("number"==typeof e.d)throw Error("Cannot invert text op: Deleted characters missing from operation. makeInvertible must be called first.");return e.d;case"string":return{d:e};case"number":return e}})}function w(e){return s(e,e=>"object"==typeof e&&"string"==typeof e.d?{d:r.strPosToUni(e.d)}:e)}function j(e){let t=!0;return i(e,e=>{"object"==typeof e&&"number"==typeof e.d&&(t=!1)}),t}t.default=function(e){return{name:"text-unicode",uri:"http://sharejs.org/types/text-unicode",trim:p,normalize:c,checkOp:o,create(t=""){if("string"!=typeof t)throw Error("Initial data must be a string");return e.create(t)},apply(n,r){o(r);const i=e.builder(n);for(let e=0;e<r.length;e++){const n=r[e];switch(typeof n){case"number":i.skip(n);break;case"string":i.append(n);break;case"object":i.del(t.dlen(n.d))}}return i.build()},transform:h,compose:b,transformPosition:g,transformSelection:y,isInvertible:j,makeInvertible:(t,n)=>m(t,n,e),stripInvertible:w,invert:v,invertWithDoc:(t,n)=>v(m(t,n,e)),isNoop:e=>0===e.length}}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.type=t.remove=t.insert=void 0;const a=n(0),c=i(n(1)),u=s(n(5)),l={create:e=>e,toString:e=>e,builder(e){if("string"!=typeof e)throw Error("Invalid document snapshot: "+e);const t=[];return{skip(n){let r=a.uniToStrPos(e,n);if(r>e.length)throw Error("The op is too long for this document");t.push(e.slice(0,r)),e=e.slice(r)},append(e){t.push(e)},del(t){e=e.slice(a.uniToStrPos(e,t))},build:()=>t.join("")+e}},slice:c.uniSlice},f=c.default(l),d=Object.assign(Object.assign({},f),{api:u.default});t.type=d,t.insert=(e,t)=>0===t.length?[]:0===e?[t]:[e,t],t.remove=(e,t)=>0===c.dlen(t)?[]:0===e?[{d:t}]:[e,{d:t}];var p=n(1);Object.defineProperty(t,"makeType",{enumerable:!0,get:function(){return p.default}})},function(e,t,n){e.exports=n(6)},function(e,t,n){"use strict";n.r(t);var r=n(2),o=n(3),i=n.n(o);t.default={OtDiff:i.a,OtUnicode:r.type}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),o=n(0);function i(e,t){return{get:e,getLength:()=>e().length,insert(n,r,i){const s=o.strPosToUni(e(),n);return t([s,r],i)},remove(n,r,i){const s=o.strPosToUni(e(),n);return t([s,{d:r}],i)},_onOp(e){r.eachOp(e,(e,t,n)=>{switch(typeof e){case"string":this.onInsert&&this.onInsert(n,e);break;case"object":const t=r.dlen(e.d);this.onRemove&&this.onRemove(n,t)}})},onInsert:null,onRemove:null}}t.default=i,i.provides={text:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),s=(r=i)&&r.__esModule?r:{default:r};var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"diff",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=s.default.assignOpts(e,t,n);return s.default.payload(r)}},{key:"transform",value:function(e,t){return this[t.action](e,t)}},{key:"insert",value:function(e,t){return e.slice(0,parseInt(t.start))+t.payload+e.slice(parseInt(t.start))}},{key:"delete",value:function(e,t){return e.slice(0,parseInt(t.start))+e.slice(parseInt(t.start)+parseInt(t.remove))}},{key:"replace",value:function(e,t){return this.insert(this.delete(e,t),t)}},{key:"noop",value:function(e){return e}}]),e}();t.default=new a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"assignOpts",value:function(e,t,n){var r={};return r.newString=t,r.oldString=e,r.raw=n,r.changeStart=this.getChangeStart(r.oldString,r.newString),r.changeFromEnd=this.getChangeFromEnd(r.oldString,r.newString,r.changeStart),r.changeEndIndexNew=r.newString.length-r.changeFromEnd,r.changeEndIndexOld=r.oldString.length-r.changeFromEnd,r.charsAdded=r.changeEndIndexNew-r.changeStart,r.charsRemoved=r.changeEndIndexOld-r.changeStart,r}},{key:"getChangeFromEnd",value:function(e,t,n){for(var r=0;r<e.length&&r<t.length&&e.length-r>n&&t.length-r>n&&e[e.length-1-r]==t[t.length-1-r];)r++;return r}},{key:"getChangeStart",value:function(e,t){for(var n=0;n<e.length&&n<t.length&&e[n]==t[n];)n++;return n}},{key:"payload",value:function(e){var t=void 0;return t=0===e.charsRemoved&&e.charsAdded>0?{action:"insert",start:e.changeStart,payload:e.newString.slice(e.changeStart,e.changeEndIndexNew)}:e.charsRemoved>0&&0===e.charsAdded?{action:"delete",start:e.changeStart,remove:e.charsRemoved}:e.charsRemoved>0&&e.charsAdded>0?{action:"replace",start:e.changeStart,remove:e.charsRemoved,payload:e.newString.substr(e.changeStart,e.charsAdded)}:{action:"noop"},e.raw&&(t.raw=e),t}}]),e}();t.default=new o}])}));